<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Settings</title>
    <link rel="stylesheet" href="style/style.css">
</head>
<body>
<div id="header">
    <h1>Settings</h1>
</div>

<div id="settings-section">
    <label for="description">Description</label>
    <textarea id="description" rows="4" cols="50"></textarea>

    <label for="photo">Upload Photo</label>
    <input type="file" id="photo">

    <button class="save-button" type="button" onclick="saveSettings()">Save</button>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function () {
        const user = JSON.parse(localStorage.getItem('loggedInUser'));
        if (user) {
            if (user.description) {
                document.getElementById('description').value = user.description;
            }
        } else {
            window.location.href = 'login-page.html';
        }
    });

    function saveSettings() {
        const description = document.getElementById('description').value;
        const photoInput = document.getElementById('photo');
        let photo = null;

        if (photoInput.files && photoInput.files[0]) {
            const reader = new FileReader();
            reader.onload = function (e) {
                photo = e.target.result;
                updateUser(description, photo);
            };
            reader.readAsDataURL(photoInput.files[0]);
        } else {
            updateUser(description, null);
        }
    }

    function updateUser(description, photo) {
        const user = JSON.parse(localStorage.getItem('loggedInUser'));
        if (user) {
            user.description = description;
            if (photo) {
                user.photo = photo;
            }

            fetch(`http://localhost:3000/users/${user.id}`, {
                method: 'PUT',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(user)
            })
            .then(response => {
                if (response.ok) {
                    localStorage.setItem('loggedInUser', JSON.stringify(user));
                    alert('Settings saved successfully!');
                    window.location.href = 'user-page.html';
                } else {
                    alert('Error saving settings');
                }
            })
            .catch(error => {
                console.error('Error:', error);
                alert('Error saving settings');
            });
        }
    }
</script>
</body>
</html>
